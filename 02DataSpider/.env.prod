# 生产环境配置文件
# 用于生产部署，包含高性能和安全配置

# 应用环境
APP_ENV=production
BUILD_TARGET=production
LOG_LEVEL=INFO

# 端口配置
API_PORT=5000
FRONTEND_PORT=3002
REDIS_PORT=6379
ZMQ_PUB_PORT=5555
ZMQ_SUB_PORT=5556

# 数据库配置
DATABASE_URL=sqlite:///data/prod.db
REDIS_URL=redis://redis:6379/2
REDIS_DB=2
DATABASE_POOL_SIZE=50
DATABASE_MAX_OVERFLOW=100

# ZeroMQ配置
ZMQ_PUBLISHER_PORT=5555
ZMQ_SUBSCRIBER_PORT=5556
ZMQ_TOPIC_PREFIX=crawler.prod
ZMQ_HIGH_WATER_MARK=10000
ZMQ_LINGER=1000

# Telegram配置 (生产环境使用加密变量)
TELEGRAM_API_ID=${TELEGRAM_PROD_API_ID}
TELEGRAM_API_HASH=${TELEGRAM_PROD_API_HASH}
TELEGRAM_BOT_TOKEN=${TELEGRAM_PROD_BOT_TOKEN}
TELEGRAM_SESSION_NAME=prod_session
TELEGRAM_FLOOD_SLEEP_THRESHOLD=60

# Scrapy配置
SCRAPY_CONCURRENT_REQUESTS=32
SCRAPY_DOWNLOAD_DELAY=3
SCRAPY_RANDOMIZE_DOWNLOAD_DELAY=1.5
SCRAPY_USER_AGENT=Mozilla/5.0 (compatible; NTN-Crawler/1.0; +https://ntn.ai/robots.txt)
SCRAPY_RETRY_TIMES=3
SCRAPY_RETRY_HTTP_CODES=500,502,503,504,408,429

# 代理配置
USE_PROXY=true
PROXY_LIST_URL=${PROXY_SERVICE_URL}
PROXY_ROTATION_INTERVAL=300
PROXY_VALIDATION_ENABLED=true
PROXY_HEALTH_CHECK_INTERVAL=60
PROXY_MAX_FAILURES=3

# 监控配置
MONITORING_ENABLED=true
METRICS_PORT=8002
HEALTH_CHECK_INTERVAL=15
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9091
GRAFANA_ENABLED=true
GRAFANA_PORT=3003

# 日志配置
LOG_FORMAT=json
LOG_FILE_MAX_SIZE=500MB
LOG_FILE_BACKUP_COUNT=20
LOG_TO_CONSOLE=false
LOG_TO_FILE=true
LOG_AGGREGATION_ENABLED=true
LOG_COMPRESSION=true

# 开发工具配置
DEBUG_MODE=false
HOT_RELOAD=false
AUTO_RESTART=true
DEV_MOUNT_SUFFIX=:ro

# 数据处理配置
DATA_VALIDATION_STRICT=true
DATA_CLEANUP_INTERVAL=900
TEMP_FILE_RETENTION=21600
DATA_QUALITY_THRESHOLD=0.95
DATA_DEDUPLICATION=true
DATA_COMPRESSION=true

# 安全配置
API_RATE_LIMIT=100
API_RATE_LIMIT_WINDOW=3600
CORS_ORIGINS=${ALLOWED_ORIGINS}
CSRF_PROTECTION=true
API_KEY_REQUIRED=true
JWT_SECRET_KEY=${JWT_SECRET_KEY}
JWT_EXPIRATION=3600
SSL_ENABLED=true

# 性能配置
WORKER_PROCESSES=4
WORKER_THREADS=16
MAX_MEMORY_USAGE=8GB
GC_THRESHOLD=0.6
CONNECTION_POOL_SIZE=100
CONNECTION_POOL_TIMEOUT=30
QUERY_TIMEOUT=30

# 缓存配置
CACHE_ENABLED=true
CACHE_TTL=3600
CACHE_MAX_SIZE=1000000
CACHE_COMPRESSION=true
REDIS_CONNECTION_POOL_SIZE=50

# 备份配置
BACKUP_ENABLED=true
BACKUP_INTERVAL=3600
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION=true
BACKUP_ENCRYPTION=true
BACKUP_STORAGE_PATH=${BACKUP_STORAGE_PATH}

# 告警配置
ALERT_ENABLED=true
ALERT_EMAIL=${PROD_ALERT_EMAIL}
ALERT_WEBHOOK=${PROD_ALERT_WEBHOOK}
ALERT_SLACK_WEBHOOK=${SLACK_WEBHOOK_URL}
ALERT_THRESHOLD_ERROR_RATE=0.01
ALERT_THRESHOLD_RESPONSE_TIME=2000
ALERT_THRESHOLD_MEMORY_USAGE=0.8
ALERT_THRESHOLD_CPU_USAGE=0.8

# 扩展配置
AUTO_SCALING_ENABLED=true
MIN_INSTANCES=2
MAX_INSTANCES=10
SCALE_UP_THRESHOLD=0.7
SCALE_DOWN_THRESHOLD=0.3
SCALE_COOLDOWN=300

# 网络配置
NETWORK_TIMEOUT=30
CONNECTION_TIMEOUT=10
READ_TIMEOUT=30
MAX_RETRIES=3
BACKOFF_FACTOR=2

# 存储配置
DATA_RETENTION_DAYS=90
LOG_RETENTION_DAYS=30
TEMP_RETENTION_HOURS=6
COMPRESSION_ENABLED=true
ENCRYPTION_ENABLED=true

# 第三方服务配置
EXTERNAL_API_TIMEOUT=15
EXTERNAL_API_RETRIES=3
EXTERNAL_API_RATE_LIMIT=1000
EXTERNAL_API_CIRCUIT_BREAKER=true