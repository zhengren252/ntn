# ReviewGuard开发环境 Dockerfile
FROM node:18-alpine

# 设置工作目录
WORKDIR /app

# 安装Python和系统依赖
RUN apk add --no-cache \
    python3 \
    py3-pip \
    python3-dev \
    build-base \
    libffi-dev \
    zeromq-dev \
    pkgconfig

# 创建Python符号链接
RUN ln -sf python3 /usr/bin/python
RUN ln -sf pip3 /usr/bin/pip

# 复制并安装Python依赖
COPY backend/requirements.txt ./backend/
RUN pip install --no-cache-dir -r backend/requirements.txt

# 复制并安装前端依赖
COPY frontend/package*.json ./frontend/
RUN cd frontend && npm install

# 复制根目录依赖文件
COPY package*.json ./
RUN npm install

# 复制源代码
COPY . .

# 创建必要的目录
RUN mkdir -p logs data

# 暴露端口
EXPOSE 3000 8000 5555 5556

# 设置环境变量
ENV PYTHONPATH=/app/backend/src
ENV NODE_ENV=development
ENV APP_ENV=development

# 启动命令（将在docker-compose中覆盖）
CMD ["npm